<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Prediction Model</title>

  <style>
      .main-page{
        display: flex;
        flex-direction: row;
        gap: 20px;
        justify-content: center;
        align-items: center;
      }
      .hero-banner {
    background-color: #0E2095;
    padding: 50px 20px;
    text-align: right-center;
    color: white;
    border-bottom: 5px solid #0E2095;
}

.hero-content h1 {
    font-size: 42px;
    margin: 0;
    font-weight: 800;
    letter-spacing: 1px;
}

.hero-content p {
    font-size: 18px;
    margin-top: 10px;
    opacity: 0.9;
}

  </style>
  <style>

    body { font-family: Arial, sans-serif; margin: 40px; color:black }

    .tab {
      overflow: hidden;
      border-bottom: 2px solid #ccc;
    }
    .tab button {
      background-color: #F2D200;
      color:white;
      border: none;
      outline: none;
      cursor: pointer;
      padding: 14px 16px;
      transition: 0.3s;
      font-size: 17px;
    }
    .tab button:hover {
      background-color: #0E2095;
    }
    .tab button.active {
      background-color: #ccc;
    }
    .tabcontent {
      display: none;
      padding: 16px;
      border: 1px solid #ccc;
      border-top: none;
    }
/* VIEW DATA CARD */
.data-card {
  margin-top: 20px;
  padding: 20px;
  border-radius: 12px;
  background: #ffffff;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  border-left: 6px solid #0E2095;
}

/* TITLE */
.data-title {
  font-size: 22px;
  font-weight: bold;
  margin-bottom: 15px;
  color: #0E2095;
}

/* SCROLL CONTAINER */
.data-scroll {
  max-height: 500px;
  overflow-y: scroll;
  border: 1px solid #ddd;
  border-radius: 8px;
}

/* TABLE STYLE */
.data-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 15px;
}

.data-table th {
  background-color: #0E2095;
  color: white;
  padding: 10px;
  position: sticky;
  top: 0;
  z-index: 1;
}

.data-table td {
  padding: 8px;
  border-bottom: 1px solid #e0e0e0;
}

.data-table tr:nth-child(even) {
  background-color: #f9f9f9;
}

.data-table tr:hover {
  background-color: #eef3ff;
}
  </style>

</head>
<body>
    <header class="hero-banner">
        <div class = "hero-content">
            <h1>My Softball Prediction Model</h1>
        </div>
    </header>

  <div class="tab">
    <button class="tablinks" onclick="openTab(event, 'Home')">Home</button>
    <button class="tablinks" onclick="openTab(event, 'Make_a_Prediction')">Make a Prediction</button>
    <button class="tablinks" onclick="openTab(event, 'view_data')">Datasets</button>
    <button class ="tablinks" onclick="openTab(event, 'history')">View Historic Rankings</button>
  </div>

  <div id="Home" class="tabcontent">
    <h2>Home</h2>
    <p>Welcome to my prediction model webpage! In each tab, there are different ways to view the data that makes my model
    possible. Feel free to explore! </p>
      <h3>About my Model</h3>
      <p>The goal of this project is to take information collected by the NCAA and the Rocky Mountain Athletic Conference (RMAC)
      and use it to predict the standings for the upcoming 2026 season next spring for the RMAC Conference in Softball.</p>
      <br>
      <h3>Features</h3>
      <p> The features used in this model are used to estimate a team's strength. In Softball, features like win percentage,
      how many runs a team scores and how many are allowed play a large part in predicting a team's strength. With this in mind, we are
      using the features listed below to predict a team's performance for the next season.</p>
      <ul>
          <li>Wins</li>
          <li>Losses</li>
          <li>Win Percentage</li>
          <li>Earned Run Average (How good is a team's pitching staff?)</li>
          <li>Fielding Percentage (How good is the team's defense?)</li>
          <li>Batting Average (How often can a team get on base/score?)</li>
      </ul>
      <br>
      <h3>Want to visit the websites used for this model? Click on one of the images below!</h3>
    <div>
        <label class ="main-page"></label>
        <a href = "https://rmacsports.org/sports/softball" target="_blank">
        <img src="static/images/RMAC_Logo.png" alt="RMAC Logo" style ="width:200px; height:200px;">
        </a>

        <a href = "https://www.ncaa.com/sports/softball/d2" target="_blank">
        <img src="static/images/NCAA_Logo.png" alt="NCAA Logo" style ="width:200px; height:200px;">
        </a>
    </div>


  </div>

 <div id="view_data" class="tabcontent">
    <h2>View a Year</h2>

    <form method="POST" action="/view_data" onsubmit="loadDataset(event)">
        <label><strong>Select Year:</strong></label>

        <!-- Match Flask: name="year" -->
        <select name="year" id="select-year">
            <option value="2023">2023</option>
            <option value="2024">2024</option>
            <option value="2025">2025</option>
        </select>

        <label><strong>Choose NCAA or RMAC:</strong></label>
        <select  name = "conference" >
            <option value ="ncaa">NCAA</option>
            <option value = "rmac">RMAC</option>
        </select>

        <button type ="submit">View Dataset</button>
    </form>

    <div id="dataset_output" class="data-card" style="display:none;">
    <div class="data-title">Dataset Preview</div>
    <div class="data-scroll">
        <div id="data_table_container"></div>
    </div>
</div>
</div>


  <div id="Make_a_Prediction" class="tabcontent">
    <h2>Make a Prediction</h2>
      <p> Select year(s) for a prediction of the 2026 season below.</p>
      <br>
            <form method = "POST" action = "/Make_a_Prediction">
                <input type="checkbox" id = "2023" value="2023">
                    <label for = "2023">2023</label>
                <input type = "checkbox" id = "2024" value="2024">
                    <label for = "2024">2024</label>
                <input type="checkbox"  id = "2025" value="2025">
                    <label for = "2025">2025</label>

        <button type = "button" onclick="predict()" > Predict </button>
                </form>
      <div id = "prediction_output"
      style="margin-top: 20px;
            padding: 15px;
            border: 2px solid #0E2095;
            background-color: #F7F7FF;
            border-radius: 10px;
            display: none;">
  </div>
      <div id="accuracy_output"
           style="margin-top: 20px;
            padding: 15px;
            border: 2px solid #0E2095;
            background-color: #F7F7FF;
            border-radius: 10px;
            display: none;">

      </div>
  </div>

  <div id="history" class ="tabcontent">
      <h1>View Previous Rankings</h1>
      <h3>RMAC Conference Champions/Tournament Appearances</h3>
      <p>Team:</p>
  </div>


  <script>
    function openTab(evt, tabName) {
      var i, tabcontent, tablinks;
      tabcontent = document.getElementsByClassName("tabcontent");
      for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
      }
      tablinks = document.getElementsByClassName("tablinks");
      for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
      }
      document.getElementById(tabName).style.display = "block";
      evt.currentTarget.className += " active";
    }

async function predict() {
    let years = [];

    ["2023", "2024", "2025"].forEach(y => {
        if (document.getElementById(y).checked) {
            years.push(y);
        }
    });

    if (years.length < 2) {
        alert("Please select at least two years for a prediction.");
        return;
    }

    let response = await fetch("/Make_a_Prediction", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({ years: years })
    });

    let data = await response.json();

   const box = document.getElementById("prediction_output");
box.style.display = "block";

// Pair teams and ranks together
let results = data.teams.map((team, i) => ({
    team: team,
    rank: data.predictions[i]
}));

// Sort lowest rank (best) to highest
results.sort((a, b) => a.rank - b.rank);

// Build HTML table
let tableHTML = `
    <h3>Predicted 2026 Standings</h3>
    <table style="border-collapse: collapse; width: 100%; margin-top: 15px;">
        <thead>
            <tr style="background-color: #0E2095; color: white;">
                <th style="padding: 8px; border: 1px solid #ccc;">RMAC Rank</th>
                <th style="padding: 8px; border: 1px solid #ccc;">Team</th>
                <th style="padding: 8px; border: 1px solid #ccc;">Predicted NCAA Ranking</th>
            </tr>
        </thead>
        <tbody>
`;

results.forEach((r, i) => {
    tableHTML += `
        <tr>
            <td style="padding: 8px; border: 1px solid #ccc;">${i + 1}</td>
            <td style="padding: 8px; border: 1px solid #ccc;">${r.team}</td>
            <td style="padding: 8px; border: 1px solid #ccc;">${r.rank.toFixed(2)}</td>
        </tr>
    `;
});

tableHTML += `
        </tbody>
    </table>
`;
let accuracyHTML = `
    <div style="margin-bottom: 15px;">
        <h3>Model Accuracy</h3>
        <p><strong>R² Score:</strong> ${data.r2.toFixed(3)}</p>
        <p><strong>Mean Absolute Error:</strong> ${data.mae.toFixed(2)} places</p>
        <em>Lower MAE = better. R² closer to 1.0 = better.</em>
    </div>
`;

box.innerHTML = accuracyHTML+tableHTML;
}

</script>
<script>
    //View a dataset
async function loadDataset(event){
    event.preventDefault();

    const formData = new FormData(event.target);
    const year = formData.get("year");
    const conference = formData.get("conference");

    let response = await fetch("/view_data", {
        method: "POST",
        body: formData
    });

    let htmlTable = await response.text();

    // Insert styled table
    document.getElementById("dataset_output").style.display = "block";
    document.getElementById("data_table_container").innerHTML =
        htmlTable.replace("<table", "<table class='data-table'");


}
</script>

</body>
</html>

